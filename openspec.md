# OpenSpec: GridClicker

> **版本**: 1.1.0
> **类型**: macOS 辅助功能工具 / 守护进程 (Daemon)
> **语言**: Swift
> **状态**: 稳定版 (Stable)

## 1. 项目概述
GridClicker 是一款专为 macOS 设计的全键盘鼠标控制工具。它采用 **Passive Overlay (被动覆盖层)** 架构，确保在操作过程中不抢占目标窗口的焦点，从而实现完美的滚动、点击和拖拽穿透体验。

## 2. 核心功能

### 2.1 全局唤起
- **触发**: 快速轻敲 **左 Command (⌘)**。
- **特性**: 窗口透明且不响应鼠标（Mouse Pass-Through），不干扰底层应用焦点。

### 2.2 导航与微调
- **AA-ZZ**: 双字母快速定位。
- **HJKL**: 像素级光标移动。
- **O 键**: 进入滚动模式 (Scroll Mode)，使用 J/K 滚动页面。

### 2.3 动作执行
- **Space (空格)**: 左键单击。
- **M 键**: 右键单击。
- **V 键 (拖拽)**: 
    - 按住 V 键进入拖拽模式 (模拟左键按下)。
    - 配合 HJKL 移动光标以选中文本或拖动文件。
    - 松开 V 键结束拖拽。
- **Enter (复制并退出)**:
    - 自动结束拖拽。
    - 发送 `Cmd+C` 复制选中内容。
    - 隐藏网格。

## 3. 技术实现 (Architecture)

### 3.1 Passive Overlay 模式
- 窗口属性设为 `ignoresMouseEvents = true` 和 `.nonactivatingPanel`。
- **优势**: 
    - 滚动事件直接发送给底层活跃窗口，无需切换焦点。
    - 拖拽事件直接作用于底层元素，无窗口遮挡问题。

### 3.2 Global Event Tap
- 由于窗口不获取焦点，所有键盘交互（定位、微调、快捷键）均通过 `CGEvent.tapCreate` 在系统底层拦截。
- 逻辑层根据内部状态机 (`GridSelection` -> `FineTuning` -> `Scrolling`) 决定是吞掉按键还是透传。

## 4. 快捷键速查
| 模式 | 按键 | 功能 |
| :--- | :--- | :--- |
| **全局** | `Left Cmd` (Tap) | 显示/隐藏网格 |
| **网格选择** | `A-Z` | 输入坐标 |
| **微调模式** | `H / J / K / L` | 移动光标 |
| | `Space` | 左键点击 |
| | `M` | 右键点击 |
| | `V` (Hold) | 拖拽选区 |
| | `Enter` | 复制选区并退出 |
| | `O` | 进入滚动模式 |
| **滚动模式** | `J / K` | 下滚 / 上滚 |
| **通用** | `Esc` | 取消/隐藏 |

## 5. 项目结构
- `src/main.swift`: 核心源码。
- `scripts/build.sh`: 编译脚本。
- `dist/GridClicker.app`: 可执行应用。
